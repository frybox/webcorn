import os
import shutil
import subprocess

print("remove webcorn build and dist directory...")
shutil.rmtree('../../build', ignore_errors=True)
shutil.rmtree('../../dist', ignore_errors=True)
subprocess.run([shutil.which('npm'), 'install'], cwd="../..")
subprocess.run([shutil.which('npm'), 'run', 'build'], cwd="../..")
print("remove deployment directory...")
shutil.rmtree('deployment', ignore_errors=True)
subprocess.run([shutil.which('npm'), 'install'])
subprocess.run([shutil.which('npm'), 'run', 'build'])
print("copy index.html...")
shutil.copy('public/index.html', 'deployment')
print("copy django.html...")
shutil.copy('public/django.html', 'deployment/project_django')
print("copy fastapi.html...")
shutil.copy('public/fastapi.html', 'deployment/project_fastapi')
print("copy flask.html...")
shutil.copy('public/flask.html', 'deployment/project_flask')
print("copy wagtail.html...")
shutil.copy('public/wagtail.html', 'deployment/project_wagtail')
print("generate project_django.zip...")
shutil.make_archive('deployment/project_django/project_django', 'zip', 'public', 'project_django')
print("generate project_fastapi.zip...")
shutil.make_archive('deployment/project_fastapi/project_fastapi', 'zip', 'public', 'project_fastapi')
print("generate project_flask.zip...")
shutil.make_archive('deployment/project_flask/project_flask', 'zip', 'public', 'project_flask')
print("generate project_wagtail.zip...")
shutil.make_archive('deployment/project_wagtail/project_wagtail', 'zip', 'public', 'project_wagtail')
print('run http server...')
os.chdir('deployment')
from http.server import test, SimpleHTTPRequestHandler
test(SimpleHTTPRequestHandler)